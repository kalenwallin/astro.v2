---
import Layout from '../layouts/Layout.astro';
//import Preloader from '../components/Preloader.astro'; We might not need a preloader if Astro is fast enough
import Navbar from '../components/Navbar.astro';
import Header from '../components/Header.astro';
import Content from '../components/Content.astro';
import type { Post, Row } from '../types';
const { title } = Astro.props;

import { Client } from '@notionhq/client';
const notion = new Client({ auth: import.meta.env.NOTION_API_KEY });
let posts_career: any = [];

// Fetch career posts from notion db
const { results } = await notion.databases.query({
    database_id: import.meta.env.NOTION_DATABASE_ID,
    filter: {
            property: 'api-v1-category',
            rich_text: {
                contains: "Career",
            }
        },
    sorts: [{
        property: 'Published',
        direction: 'descending'
    }]
});
await results.map((result: any) => {
    const resultProps: any = result.properties;
    posts_career = [...posts_career, {
        slug: resultProps.api_v3_link.url,
        img: resultProps.api_v1_cover.url,
        title: resultProps.api_v1_company.rich_text[0].text.content + " - " + resultProps.api_v1_role.rich_text[0].text.content,
    }] 
});
console.log(results);

// Aggregate posts categories into rows
const rows: Row[] = [posts_career];

---
<Layout title={title}>
    <!--<Preloader /> We might not need a preloader if Astro is fast enough-->
    <Navbar rows={rows}/>
    <Header />
    <Content rows={rows}/>
    <script src="../scripts/preloader.js"></script>
</Layout>